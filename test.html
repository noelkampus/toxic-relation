<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bubble Chart from Sankey Nodes</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
</head>
<body>
    <div id="sankey-container"></div>
    <div id="bubble-chart"></div>

    <script>
        const data = {
            nodes: [
                { id: "UBS" }, { id: "SNB" }, { id: "Pictet" }, { id: "ZKB" }, { id: "Vontobel" },
                { id: "Exxon Mobil Corporation" }, { id: "Chevron Corporation" }, { id: "Partners Group Holding AG" },
                { id: "Shell plc" }, { id: "TotalEnergies SE" }, { id: "NextEra Energy Inc" },
                { id: "General Electric Company" }, { id: "ConocoPhillips" }, { id: "Blackstone Inc" },
                { id: "Schlumberger Ltd (SLB)" }, { id: "BP plc" }, { id: "Canadian Natural Resources Ltd (CNRL)" },
                { id: "The Southern Company" }, { id: "Enbridge Inc" }, { id: "Siemens AG" }, { id: "RWE AG" },
                { id: "Sempra Energy" }, { id: "DTE Energy Co" }, { id: "National Grid plc" },
                { id: "SSE plc" }, { id: "WEC Energy Group Inc" }, { id: "E.ON SE" }, { id: "Enel SpA" },
                { id: "Transnet SOC Ltd" }, { id: "Petroleos Mexicanos (PEMEX)" }, { id: "JSC NC KazMunayGas (KMG)" },
                { id: "Petro Rio SA (PRIO)" }, { id: "Oil" }, { id: "Gas" }, { id: "Coal" }
            ],
            links: [
                { source: "UBS", target: "Exxon Mobil Corporation", value: 3222 },
                { source: "UBS", target: "Chevron Corporation", value: 3011 },
                { source: "Exxon Mobil Corporation", target: "Oil", value: 2611 },
                { source: "Chevron Corporation", target: "Gas", value: 1242 },
                { source: "Chevron Corporation", target: "Coal", value: 828 }
            ]
        };

        const width = 800;
        const height = 500;

        const sankey = d3.sankey()
            .nodeId(d => d.id)
            .nodeWidth(1)
            .nodePadding(2)
            .extent([[1, 1], [width, height]]);

        const { nodes, links } = sankey({
            nodes: data.nodes.map(d => Object.assign({}, d)),
            links: data.links.map(d => Object.assign({}, d))
        });

        const bubbleData = [
            { id: "Oil", height: nodes.find(node => node.id === "Oil").y1 - nodes.find(node => node.id === "Oil").y0 },
            { id: "Gas", height: nodes.find(node => node.id === "Gas").y1 - nodes.find(node => node.id === "Gas").y0 },
            { id: "Coal", height: nodes.find(node => node.id === "Coal").y1 - nodes.find(node => node.id === "Coal").y0 }
        ];

        const bubbleSvg = d3.select("#bubble-chart")
            .append("svg")
            .attr("width", 400)
            .attr("height", 600);

        let currentY = 0;
        bubbleSvg.selectAll("circle")
            .data(bubbleData)
            .join("circle")
            .attr("cx", 200)
            .attr("cy", d => {
                const radius = Math.sqrt(d.height / Math.PI) * 2;
                const y = currentY + radius;
                currentY += radius * 2 + 2; // 2px spacing
                return y;
            })
            .attr("r", d => Math.sqrt(d.height / Math.PI) * 2)
            .attr("fill", "black");

        bubbleSvg.selectAll("text")
            .data(bubbleData)
            .join("text")
            .attr("x", 200)
            .attr("y", d => {
                const radius = Math.sqrt(d.height / Math.PI) * 2;
                return currentY - radius * 2;
            })
            .text(d => `${d.id}: ${d.height}`);
    </script>
</body>
</html>